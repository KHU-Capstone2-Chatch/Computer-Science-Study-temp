#
## 1.2 교착 상태의 예
- 스풀링 시스템에서 발생하는 교착 상태   
디스크에 할당된 스풀 공간의 출력을 완료하지 않은 상태에서 다른 작업이 스풀 공간을 모두 차지
- 디스크를 공유할 때 발생하는 교착 상태
디스크 사용 제어가 없는 경우 (디스크 제어기가 프로세서와 독립적으로 작동)
- 네트워크에서 발생하는 교착 상태

## 1.3 교착 상태의 발생 조건
1. 상호배제 : 자원을 최소 하나 이상 비공유
2. 점유와 대기 : 자원을 최소한 하나 보유, 다른 프로세스에 할당된 자원을 얻으려고 기다리는 프로세스 존재
3. 비선점 : 자원을 선점할 수 없음
4. 순환(환형) 대기 : P0은 P1이, Pn-1은 Pn이, Pn은 P0이 보유한 자원을 얻으려고 기다리는 상태

## 1.4 교착 상태의 표현
시스템 자원 할당 그래프 < 방향 그래프로 표현

그래프에 사이클이 없다면 교착 상태가 발생하지 않는다.
사이클이 있으면 교착 상태가 발생할 수 있다.
(사이클은 교착 상태의 필요 조건, 즉 사이클이 있다고 반드시 교착 상태가 발생하는 것은 아님)

# 2 교착 상태의 해결 방법
1. 교착 상태가 발생하지 않도록 예방
2. 교착 상태의 발생 가능성을 배체하지 않고 이를 적절히 회피
3. 교착 상태를 허용하되 교착 상태를 탐지하여 다시 회복

## 2.1 교착 상태 예방
교착 상태의 네가지 조건 중 하나라도 발생하지 않으면 교착 상태 예방 가능

> 하벤더가 제안한 세가지 방법
> - 각 프로세스는 필요한 자원을 한 번에 모두 요청해야 하며, 
> 요청한 자원을 모두 제공받기 전까지는 작업을 진행할 수 없다.
> - 어떤 자원을 점유하고 있는 프로세스의 요청을 더 이상 허용하지 않으면 점유한 자원을
> 모두 반납하고, 필요할 때 다시 자원을 요청해야 한다.
> - 모든 프로세스에 자원을 순서대로 할당해야 한다. 모든 프로세스에 각 자원 유형별로 할당 순서를 부여한 후
> 순서에 따라 자원을 요청하게 된다.

### 2.1.1 자원의 상호배제 조건 방지
전제 조건 : 자원의 비공유 
모든 자원을 공유하는 경우 교착상태가 발생하지 않지만,
현실적으로 자원은 공유 자체가 불가능할 때도 있다. ex) 파일 쓰기

### 2.1.2 점유와 대기 조건 방지
- 최대 자원 할당 : 프로세스가 작업을 수행하기 전에 필요한 자원을 한꺼번에 요청하고 허욜할 때까지 작업을 보류,
- 프로세스가 자원을 전현 갖고 있지 않을 때만 자원 요청 허용 (추가 요청을 위해서는 현재 할당된 자원을 모두 해제해야 함)

#### 단점
- 자원의 효율성이 낮다. 많은 자원이 사용되지 않으면서 오랫동안 할당되어 있다.
- 기아 상태 발생할 수 있다. 자주 사용하는 자원이 다른 프로세스에 할당되엉 있으면
무한정 기다려야 함 
> 대화식 시스템에서 사용 불가

### 2.1.3 비선점 조건 방지
전제 조건 : 이미 할당된 자원에 선점권이 없어야 한다.
- 어떤 자원을 가진 프로세스가 다른 자원을 요청할 때 
요청한 자원을 즉시 할당받을 수 없어 기다려야 한다면, 
프로세스는 현재 가진 자원을 모두 해제해야한다. 
그리고 프로세스가 작업을 시작할 때는 요청한 새로운 자원과 해제한 자원을 확보해야 한다.
- 프로세스에 우선순위 부여, 높은 우선순위의 프로세스가 그보다 낮은 우선순위의 프로세스가 점유한 자원을 선점
> 이미 실행한 작업의 상태를 잃을 수 있기 때문에, 
> 작업 상태를 쉽게 저장, 복구할 수 있을 때(프로세서 레지스터, 기억장치 레지스터) 좋은 방법
> (프린터, 테이프 드라이버와 같은 자원 x)

### 2.1.4 순환(환형) 대기 조건 방지
모든 자원에 일련의 순서를 부여하고 각 프로세스가 오름차순으로만 자원을 요청할 수 있게 한다.
이는 계층적 요청 방법으로 순환 대기의 가능성 제거
> 예상된 순서와 다르게 자원을 요청하는 작업은 
> 실제로 자원을 사용하기 풜씬 전부터 오랫동안 자원을 할당받은 상태로 있어야 하므로
> 자원 낭비 발생

### 단점
장치의 효율성과 시스템의 처리량이 떨어짐

## 2.2 교착 상태 회피
교착 상태의 모든 발생 가능성을 미리 제거
1. 프로세스의 시작 중단 : 프로세스의 요구가 교착 상태를 발생시킬 수 있다면 프로세스 시작을 중단
2. 자원 할당 거부 : 프로세스가 요청한 자원을 할당했을 때 교착 상태가 발생할 수 있다면 
요청한 자원을 할당하지 않는다. (Banker's algorithm)

### 2.2.1 프로세스의 시작 중단

- 자원 할당 상태 : 사용 가능한 자원수, 할당된 자원 수, 프로세스들의 최대 요청 수
- 안정된 상태 : 각 프롯스에 최대치까지 자원을 할당할 수 있고, 교착 상태를 예방할 수 있으면 안정된 상태
- 시스템에 안정 순서가 있으면 그 시스템은 안정하다.
> 교착 상태는 불안정 상태   
> 불안정 상태는 교착 상태일 가능성 또는 교착 상태가 될 가능성이 있는 상태

시스템이 항상 안정 상태에 머물러 있도록 하는 방법으로
프로세스가 현재 사용 가능한 자원을 요청할 때마다 
시스템은 자원을 즉시 할당할 수 있는지 또는 프로세스가 대기해야 하는지 결정한다.
자원을 할당한 후에도 시스템이 항상 안정 상태에 있을때만 할당을 허용

### 2.2.2 자원 할당 거부 (Banker's algorithm)
자원의 할당 허용 여부를 결정하기 전에 
미리 결정된 모든 자원의 최대 가능한 할당량을 시뮬레이션하여 안전 여부를 검사한다.

- Available : 사용 가능한 자원수
- Max : 각 프로세스 자원의 최대 요청량
- Allocation : 각 프로세스에 할당되어잇는 각 형태의 자원수
- Need : 각 프로세스에 남아 있는 자원 요청, Need = Max - Allocation

#### 단점

## 2.3 교착 상태 회복
- 시스템 상태를 검사하는 교착 상태 탐지 알고리즘
- 교착 상태에서 회복시키는 알고리즘

교착 상태에 바진 프로세스를 빨리 발견하여 자원의 유휴 상태를 방지하지만
너무 자주 실행하면 시스템의 성능이 떨어짐

## 2.3.1 교착 상태 탐지 알고리즘
## 2.3.2 교착 상태 회복 방법
- 프로세스 중단
    - 교착 상태 프로세스를 모두 중단
    - 한 프로세스씩 중단
- 자원 선점   
자원 선점을 이용하여 교착 상태를 해결하려면 프로세스의 자원을 선점해서
교착 상태를 해결할 때까지 선점한 자원을 다른 프로세스에 할당해야 한다.
    - 선점 자원 선택
    - 복귀
    - 기아
    
# 3. 기아
교착 상태의 해결책은 기아 상태의 가능성을 제거하지 못한다.
따라서 기아 상태 해결은 먼저 기다리는 작업을 발견하고, 
각 작업이 기다린 시간을 조사, 추적해야 한다.

또 시스템은 기아 상태를 발견하면 즉시 새로운 작업의 시작을 대기하도록 조치해야한다.
그러나 이 경우 빈번한 시스템 대기로 처리량이 감소할 수 잇으므로 매우 신중한 접근이 필요하다.